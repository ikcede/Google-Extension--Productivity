function open(e){var t=localStorage[e];if(!t||typeof t==="undefined"){return{prod:false,time:-1,timer:false,unproductive:[]}}else return JSON.parse(t)}function save(e,t){localStorage[t]=JSON.stringify(e)}function extractDomain(e){var t=document.createElement("a");t.href=e;return t.hostname}$(document).on("click","#flipprod",function(){var e=open("productive.ly");if($("#productivity .flip").hasClass("on")){$("#productivity .flip").removeClass("on").addClass("off").text("OFF");chrome.browserAction.setIcon({path:"iconminus.png"});e.prod=false;save(e,"productive.ly");chrome.tabs.getSelected(null,function(t){var n=extractDomain(t.url);if(e.unproductive.indexOf(n)>-1){chrome.tabs.insertCSS(t.id,{code:"body{opacity:1 !important;}"})}})}else{$("#productivity .flip").removeClass("off").addClass("on").text("ON");chrome.browserAction.setIcon({path:"iconplus.png"});e.prod=true;save(e,"productive.ly");chrome.tabs.getSelected(null,function(t){var n=extractDomain(t.url);if(e.unproductive.indexOf(n)>-1){chrome.tabs.insertCSS(t.id,{code:"body{opacity:.2 !important;}"})}})}});$(document).on("click","#flippage",function(){chrome.tabs.getSelected(null,function(e){var t=extractDomain(e.url);var n=open("productive.ly");if($("#page .flip").hasClass("on")){$("#page .flip").removeClass("on").addClass("off").text("Unproductive");if(n.unproductive.indexOf(t)<0){n.unproductive.push(t)}if(n.prod){chrome.tabs.insertCSS(e.id,{code:"body{opacity:.2 !important;}"})}}else{$("#page .flip").removeClass("off").addClass("on").text("Productive");if(n.unproductive.indexOf(t)>-1){n.unproductive.splice(n.unproductive.indexOf(t),1)}chrome.tabs.insertCSS(e.id,{code:"body{opacity:1 !important;}"})}save(n,"productive.ly")})});$(document).on("click","#settimer",function(){});$(document).ready(function(){var e=open("productive.ly");if(e.prod){chrome.browserAction.setIcon({path:"iconplus.png"})}else{$("#productivity .flip").removeClass("on").addClass("off").text("OFF");chrome.browserAction.setIcon({path:"iconminus.png"})}chrome.tabs.getSelected(null,function(t){var n=extractDomain(t.url);if(e.unproductive.indexOf(n)>-1){$("#page .flip").removeClass("on").addClass("off").text("Unproductive")}})})